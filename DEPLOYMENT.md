# Deploying Guardrail Contracts

This guide explains how to deploy the generated Guardrail contracts to various blockchains.

## Quick Deploy (Easiest Methods)

### 1. **Remix IDE (No Setup Required)**
Best for: Testing and small deployments

1. Open [Remix IDE](https://remix.ethereum.org)
2. Create a new file called `Guardrail.sol`
3. Copy your generated contract from `build/Guardrail.sol`
4. Compile with Solidity 0.8.19
5. Connect MetaMask and deploy

### 2. **Thirdweb Deploy (One Command)**
Best for: Quick mainnet deployments with UI

```bash
# Install thirdweb
npm install -g @thirdweb-dev/cli

# Deploy (opens browser)
npx thirdweb deploy build/Guardrail.sol
```

### 3. **Local Testing with Hardhat**
Best for: Development and testing

```bash
# Start local node
npx hardhat node

# In another terminal, deploy
npx hardhat run deploy/deploy-guardrail.js --network localhost
```

## Production Deployment

### Prerequisites
1. Create `.env` file:
```env
DEPLOYER_PRIVATE_KEY=your_private_key_without_0x
ETHEREUM_RPC_URL=https://eth-mainnet.g.alchemy.com/v2/YOUR_KEY
GOERLI_RPC_URL=https://eth-goerli.g.alchemy.com/v2/YOUR_KEY
```

2. Fund your deployer address with ETH for gas

### Deploy to Testnet First
```bash
# Copy contract to contracts folder
mkdir -p contracts
cp build/Guardrail.sol contracts/

# Deploy to Goerli testnet
npx hardhat run deploy/deploy-guardrail.js --network goerli
```

### Deploy to Mainnet
```bash
# Deploy to Ethereum mainnet (costs real ETH!)
npx hardhat run deploy/deploy-guardrail.js --network mainnet

# Deploy to Polygon (cheaper)
npx hardhat run deploy/deploy-guardrail.js --network polygon

# Deploy to Arbitrum (cheap & fast)
npx hardhat run deploy/deploy-guardrail.js --network arbitrum
```

## Solana Deployment

For Solana programs generated by Shor:

```bash
# Using Anchor (if you have Anchor setup)
anchor build
anchor deploy --provider.cluster devnet

# Using Solana CLI directly
solana program deploy build/guardrail.so
```

## Post-Deployment

### 1. Verify Contract (Ethereum)
The deployment script auto-verifies on Etherscan. Manual verification:
```bash
npx hardhat verify --network mainnet DEPLOYED_ADDRESS
```

### 2. Integration Example
```javascript
// In your dApp
const GUARDRAIL_ADDRESS = "0x..."; // Your deployed address

// Import ABI from artifacts
const GuardrailABI = require("./artifacts/contracts/Guardrail.sol/Guardrail.json").abi;

// Connect to contract
const guardrail = new ethers.Contract(GUARDRAIL_ADDRESS, GuardrailABI, signer);

// Use compliance checks
const canInvest = await guardrail.checkCompliance(userAddress, amount, country);
```

### 3. Monitor Contract
- Watch for `ComplianceCheckFailed` events
- Monitor total raised vs cap
- Track KYC verification events

## Cost Estimates

Typical deployment costs:
- **Ethereum Mainnet**: ~$50-200 (depending on gas)
- **Polygon**: ~$0.10-1
- **Arbitrum**: ~$1-5
- **Solana**: ~$0.01

## Security Checklist

Before mainnet deployment:
- [ ] Audit the generated contract
- [ ] Test all compliance rules
- [ ] Verify dates/amounts are correct
- [ ] Set up multisig for admin functions
- [ ] Have incident response plan

## Troubleshooting

**"Insufficient funds"**: Add ETH to your deployer address

**"Contract size too large"**: Enable optimizer in hardhat.config.js

**"Nonce too high"**: Reset MetaMask account

**"Cannot estimate gas"**: Check contract has valid dates (not NaN)

## Need Help?

- [Hardhat Deployment Docs](https://hardhat.org/tutorial/deploying-to-a-live-network)
- [Remix IDE Tutorial](https://remix-ide.readthedocs.io/en/latest/deploy.html)
- [Thirdweb Deploy Docs](https://portal.thirdweb.com/deploy)